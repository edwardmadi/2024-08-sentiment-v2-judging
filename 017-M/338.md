Abundant Maroon Pangolin

Medium

# PUSH0 is not supported on all EVM compatible chains

### Summary

The current codebase is compiled with Solidity version `^0.8.24`, which includes the PUSH0 opcode in the compiled bytecode. 
According to the contest Readme the project is going to be deployed on `Any EVM-compatbile network`. 
Some chains do not support `PUSH0` opcode. 

### Root Cause

1. Project is compiled with Solidity `^0.8.24` which includes `PUSH0` opcode (introduced with [0.8.20](https://github.com/ethereum/solidity/releases/tag/v0.8.20). 
2. Project [config](https://github.com/sherlock-audit/2024-08-sentiment-v2/blob/0b472f4bffdb2c7432a5d21f1636139cc01561a5/protocol-v2/foundry.toml#L14) has `evm_version = 'shanghai'`
3. Some chains (eg. [Linea](https://docs.linea.build/developers/quickstart/ethereum-differences) ) do not support this opcode and can lead to unexpected behavior.

### Internal pre-conditions

_No response_

### External pre-conditions

_No response_

### Attack Path

If we decompile the deployed bytecode using an online [tool](https://app.dedaub.com/decompile?network=ethereum) we can see that `push0` is included in the generated bytecode. 
Below you can see the beginnng of `Registry` contract decompiled: 
```txt
    0x0: PUSH1     0x80
    0x2: PUSH1     0x40
    0x4: MSTORE    
    0x5: CALLVALUE 
    0x6: DUP1      
    0x7: ISZERO    
    0x8: PUSH2     0xf
    0xb: JUMPI     
    0xc: PUSH0     // @audit here
    0xd: DUP1  
```

### Impact

Deploying protocol  using current solidity version `^0.8.24` may result in unexpected behavior  in chains that do not support this opcode or, in best case it can't be deployed at all. 

### PoC

_No response_

### Mitigation

I see two different approaches to this problem:
1. either change the compiler version to a version < 0.8.20 when deploying to a chain that do not support Shanghai fork;
2. use same compiler version <0.8.20 on all chains to ensure consistency.

You can use [this](https://www.evmdiff.com/features?feature=opcodes) or [this](https://push0.info/) tool as a starting point on checking which chain support push0 opcode.